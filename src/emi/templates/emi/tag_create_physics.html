{% extends 'base.html' %}

{% block title %}{% if editing %}Edit {{ tag.tag_label }}{% else %}Create Physics Tag{% endif %} - EMI{% endblock %}

{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'emi:emi_hub' %}">EMI</a></li>
            <li class="breadcrumb-item"><a href="{% url 'emi:tags_list' tag_type='p' %}">Physics Tags</a></li>
            <li class="breadcrumb-item active">{% if editing %}Edit {{ tag.tag_label }}{% else %}Create{% endif %}</li>
        </ol>
    </nav>

    <h2>{% if editing %}Edit {{ tag.tag_label }}{% else %}Create Physics Tag{% endif %}</h2>
    <p>{% if not editing %}A tag number will be auto-assigned based on the selected category.{% endif %}</p>

    <form method="post" class="mt-3" style="max-width: 700px;">
        {% csrf_token %}

        <div class="mb-3">
            <label for="{{ form.category.id_for_label }}" class="form-label"><strong>Category</strong> <span class="text-danger">*</span></label>
            <select name="category" id="{{ form.category.id_for_label }}" class="form-select">
                <option value="">Select category</option>
                {% for cat in form.category.field.queryset %}
                <option value="{{ cat.pk }}" {% if form.category.value|stringformat:"s" == cat.pk|stringformat:"s" %}selected{% endif %}>{{ cat.digit }}: {{ cat.name }}</option>
                {% endfor %}
            </select>
            {% if form.category.errors %}<div class="text-danger">{{ form.category.errors }}</div>{% endif %}
        </div>

        <div class="mb-3">
            <label for="{{ form.description.id_for_label }}" class="form-label"><strong>Description</strong></label>
            <textarea name="description" id="{{ form.description.id_for_label }}" class="form-control" rows="3">{{ form.description.value|default:"" }}</textarea>
        </div>

        <div class="mb-3">
            <label for="{{ form.created_by.id_for_label }}" class="form-label"><strong>Created By</strong></label>
            <input type="text" name="created_by" id="{{ form.created_by.id_for_label }}" class="form-control" value="{{ form.created_by.value|default:"" }}">
        </div>

        <h5 class="mt-4 mb-3">Parameters</h5>
        <p class="text-muted">Required parameters are marked with *.</p>
        {% for field in form %}
            {% if field.name|slice:":6" == "param_" %}
            <div class="mb-3">
                <label for="{{ field.id_for_label }}" class="form-label">
                    <code>{{ field.label }}</code>
                    {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                <input type="text" name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-control" value="{{ field.value|default:"" }}" {% if field.field.required %}required{% endif %}>
                {% if field.errors %}<div class="text-danger">{{ field.errors }}</div>{% endif %}
            </div>
            {% endif %}
        {% endfor %}

        <button type="submit" class="btn btn-primary">{% if editing %}Save Changes{% else %}Create Tag{% endif %}</button>
        <a href="{% url 'emi:tags_list' tag_type='p' %}" class="btn btn-secondary">Cancel</a>
    </form>
</div>
{% endblock %}

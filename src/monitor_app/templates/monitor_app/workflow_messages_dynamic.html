{% extends "monitor_app/_datatable_dynamic_base.html" %}

{% block initial_filters %}
{
    namespace: '{{ selected_namespace|default:"" }}',
    message_type: '{{ selected_message_type|default:"" }}',
    sender_agent: '{{ selected_sender_agent|default:"" }}',
    recipient_agent: '{{ selected_recipient_agent|default:"" }}',
    workflow: '{{ selected_workflow|default:"" }}',
    is_successful: '{{ selected_is_successful|default:"" }}'
}
{% endblock %}

{% block default_order %}[[0, 'desc']]{% endblock %} <!-- Order by timestamp descending -->

{% block update_active_filters_display %}
const badges = [];

// Show active filters
if (currentFilters.namespace) {
    badges.push(`<span class="badge bg-info me-1">namespace: ${currentFilters.namespace}</span>`);
}
if (currentFilters.message_type) {
    badges.push(`<span class="badge bg-info me-1">message_type: ${currentFilters.message_type}</span>`);
}
if (currentFilters.sender_agent) {
    badges.push(`<span class="badge bg-info me-1">sender_agent: ${currentFilters.sender_agent}</span>`);
}
if (currentFilters.recipient_agent) {
    badges.push(`<span class="badge bg-info me-1">recipient_agent: ${currentFilters.recipient_agent}</span>`);
}
if (currentFilters.workflow) {
    badges.push(`<span class="badge bg-info me-1">workflow: ${currentFilters.workflow}</span>`);
}
if (currentFilters.is_successful) {
    badges.push(`<span class="badge bg-info me-1">is_successful: ${currentFilters.is_successful}</span>`);
}

if (badges.length > 0) {
    $('#filter-badges').html(badges.join('&nbsp;&nbsp;'));
    $('#active-filters').show();
} else {
    $('#active-filters').hide();
}

// Update filter link active states
$('.filter-link').removeClass('filter-active');
$('.filter-link[data-filter="namespace"][data-value="' + currentFilters.namespace + '"]').addClass('filter-active');
$('.filter-link[data-filter="message_type"][data-value="' + currentFilters.message_type + '"]').addClass('filter-active');
$('.filter-link[data-filter="sender_agent"][data-value="' + currentFilters.sender_agent + '"]').addClass('filter-active');
$('.filter-link[data-filter="recipient_agent"][data-value="' + currentFilters.recipient_agent + '"]').addClass('filter-active');
$('.filter-link[data-filter="workflow"][data-value="' + currentFilters.workflow + '"]').addClass('filter-active');
$('.filter-link[data-filter="is_successful"][data-value="' + currentFilters.is_successful + '"]').addClass('filter-active');
{% endblock %}
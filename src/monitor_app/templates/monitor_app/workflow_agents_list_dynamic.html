{% extends 'base.html' %}

{% block title %}{{ table_title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>{{ table_title }}</h2>
    <p>{{ table_description }}</p>

    <!-- DataTable -->
    <div class="table-responsive">
        <table id="main-table" class="table table-striped table-bordered table-sm">
            <thead class="thead-dark">
                <tr>
                    {% for column in columns %}
                        <th>{{ column.title }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                <!-- Data loaded via AJAX -->
            </tbody>
        </table>
    </div>

</div>

<style>
/* DataTables styling */
#main-table_wrapper .top {
    display: none; /* Hide default controls */
}
#main-table_wrapper .bottom {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    margin-top: 0.75rem !important;
}
.dataTables_info {
    margin-bottom: 0 !important;
}
.dataTables_paginate {
    margin-top: 0 !important;
    margin-bottom: 0 !important;
}

/* Clean pagination styling */
.dataTables_paginate {
    margin-top: 1rem !important;
}
.dataTables_paginate .paginate_button {
    display: inline-block !important;
    padding: 0.375rem 0.75rem !important;
    margin: 0 0.125rem !important;
    border: 1px solid #dee2e6 !important;
    border-radius: 0.25rem !important;
    background: white !important;
    color: #007bff !important;
    text-decoration: none !important;
    line-height: 1.5 !important;
}
.dataTables_paginate .paginate_button:hover {
    background: #e9ecef !important;
    border-color: #adb5bd !important;
}
.dataTables_paginate .paginate_button.current {
    background: #007bff !important;
    border-color: #007bff !important;
    color: white !important;
}
.dataTables_paginate .paginate_button.disabled {
    color: #6c757d !important;
    background: #e9ecef !important;
    border-color: #dee2e6 !important;
    cursor: not-allowed !important;
}

#main-table_processing {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 20px;
    text-align: center;
    font-weight: bold;
}
</style>

<!-- DataTables CSS/JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize DataTable
    let table = $('#main-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: '{{ ajax_url }}'
        },
        columns: [
            {% for column in columns %}
            { 
                data: null,
                orderable: {{ column.orderable|yesno:"true,false" }},
                render: function(data, type, row) {
                    return row[{{ forloop.counter0 }}];
                }
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ],
        order: {% if default_order %}{{ default_order|safe }}{% else %}[[0, 'asc']]{% endif %},
        pageLength: 100,
        lengthMenu: [[100, 300, 1000, -1], [100, 300, 1000, 'All']],
        dom: 'rt<"bottom"ip><"clear">', // Table, processing, info and pagination
        responsive: true,
        pagingType: "full_numbers",
        language: {
            processing: 'Loading data...',
            emptyTable: 'No records found.',
            zeroRecords: 'No matching records found.',
            info: "Showing _START_ to _END_ of _TOTAL_ entries",
            infoFiltered: "(filtered from _MAX_ total entries)",
            paginate: {
                first: "First",
                last: "Last", 
                next: "Next",
                previous: "Previous"
            }
        },
    });
});
</script>

{% endblock %}
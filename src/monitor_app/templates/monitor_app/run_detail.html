{% extends 'base.html' %}

{% block title %}Run {{ run.run_number }} Details - SWF Monitor{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2>Run {{ run.run_number }} Details</h2>
            
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Run Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th>Run Number:</th>
                                    <td>{{ run.run_number }}</td>
                                </tr>
                                <tr>
                                    <th>Status:</th>
                                    <td>
                                        {% if run.end_time %}
                                            <span class="badge badge-secondary">Completed</span>
                                        {% else %}
                                            <span class="badge badge-success">Active</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Start Time:</th>
                                    <td>{{ run.start_time|date:"Y-m-d H:i:s" }}</td>
                                </tr>
                                <tr>
                                    <th>End Time:</th>
                                    <td>{{ run.end_time|date:"Y-m-d H:i:s"|default:"â€”" }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th>Duration:</th>
                                    <td>
                                        {% if run.end_time %}
                                            {{ run.end_time|timeuntil:run.start_time }}
                                        {% else %}
                                            {{ run.start_time|timesince }} (ongoing)
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>STF Files:</th>
                                    <td>{{ run.stf_files.count }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            {% if run.run_conditions %}
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Run Conditions</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            {% for key, value in run.run_conditions.items %}
                            <tr>
                                <th style="width: 30%;">{{ key|title }}</th>
                                <td>{{ value }}</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <p></p>

            <div class="mt-3">
                <div><a href="{% url 'monitor_app:stf_files_list' %}?run_number={{ run.run_number }}" class="btn btn-info">View STF Files ({{ run.stf_files.count }})</a></div>
                <div><a href="{% url 'monitor_app:fastmon_files_list' %}?run_number={{ run.run_number }}" class="btn btn-info">View TF Files ({{ tf_files_count }})</a></div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script>
  $(document).ready(function() {
    $('#stf-files-table').DataTable({
      paging: true,
      pageLength: 25,
      lengthMenu: [[10, 25, 50, -1], [10, 25, 50, 'All']],
      ordering: true,
      order: [[3, 'desc']],
      info: true,
      searching: true,
      responsive: true,
      language: {
        search: "Filter files:",
        lengthMenu: "Show _MENU_ files",
        info: "Showing _START_ to _END_ of _TOTAL_ files",
        emptyTable: "No STF files found for this run.",
        paginate: {
          first: "First",
          last: "Last",
          next: "Next",
          previous: "Previous"
        }
      }
    });
    $(table.table().container()).find('input[type="search"]').css({'width':'24em','display':'inline-block'});
  });
</script>
{% endblock %}